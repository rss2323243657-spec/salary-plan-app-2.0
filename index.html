<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    
    <!-- ===== PWA & æ‰‹æœº App åŒ– ===== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#2c5364">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="è–ªé…¬è®¡åˆ’">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <title>å¤šæœˆä»½æ‰¹é‡æŸ¥çœ‹ + è‡ªå®šä¹‰æ˜ç»† + é€‰æ‹©æ€§æ‰¹é‡å¡«å…… è–ªé…¬è®¡åˆ’è¡¨</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c5364, #203a43, #0f2027);
            color: #fff;
            padding: 28px;
            text-align: center;
        }

        .header h1 {
            font-size: 30px;
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            letter-spacing: 0.5px;
        }

        /* é€šç”¨æŠ˜å æ¨¡å—æ ·å¼ */
        .collapse-module {
            border-bottom: 1px solid #e9f0f5;
        }
        .collapse-header {
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            background-color: #f8fafc;
            position: relative;
        }
        .collapse-title {
            font-size: 16px;
            color: #2c5364;
            font-weight: 600;
        }
        .collapse-btn {
            width: 20px;
            height: 20px;
            background-color: #2c5364;
            color: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            z-index: 2;
            padding: 0;
            position: relative;
        }
        .collapse-btn:hover {
            background-color: #1a2a33;
            transform: scale(1.05);
        }
        .collapse-btn::after {
            content: '';
            width: 6px;
            height: 6px;
            border-right: 1.5px solid #fff;
            border-bottom: 1.5px solid #fff;
            transform: rotate(45deg);
            transition: transform 0.3s ease;
        }
        .collapse-btn.collapsed::after {
            transform: rotate(-135deg);
        }
        .collapse-content {
            transition: all 0.3s ease;
            display: block;
        }
        .collapsed {
            display: none !important;
        }

        /* æ‰¹é‡æœˆä»½é€‰æ‹©é¢æ¿ */
        .batch-filter {
            padding: 20px 30px;
            background-color: #f8fafc;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-item label {
            font-size: 14px;
            color: #2c5364;
            font-weight: 600;
        }

        .filter-item select, .filter-item input {
            padding: 10px 14px;
            border: 1px solid #dce6ed;
            border-radius: 6px;
            outline: none;
            font-size: 14px;
            color: #333;
            background-color: #fff;
            min-width: 120px;
            transition: all 0.2s;
        }

        .filter-item select:focus, .filter-item input:focus {
            border-color: #2c5364;
            box-shadow: 0 0 0 2px rgba(44, 83, 100, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            padding: 10px 18px;
            background-color: #2c5364;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background-color: #1a2a33;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .btn-add {
            background-color: #2e7d32;
        }

        .btn-add:hover {
            background-color: #1b5e20;
        }

        .btn-del {
            background-color: #c62828;
        }

        .btn-del:hover {
            background-color: #8e0000;
        }

        .btn-batch {
            background-color: #1976d2;
        }

        .btn-batch:hover {
            background-color: #0d47a1;
        }

        .btn-save {
            background-color: #f57f17;
        }

        .btn-save:hover {
            background-color: #e65100;
        }

        .btn-fillToPlan {
            background-color: #7b1fa2;
        }

        .btn-fillToPlan:hover {
            background-color: #4a148c;
        }

        .view-tip {
            font-size: 13px;
            color: #666;
            margin-left: auto;
            font-style: italic;
        }

        /* è‡ªå®šä¹‰æ˜ç»†é¢æ¿ */
        .custom-item-panel {
            padding: 15px 30px;
            background-color: #f0f4f8;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .custom-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .custom-item input {
            width: 180px;
        }

        /* æ‰¹é‡å¡«å……é¢æ¿ */
        .batch-fill-panel {
            padding: 15px 30px;
            background-color: #e9f0f5;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .batch-fill-title {
            font-size: 14px;
            color: #2c5364;
            font-weight: 600;
        }

        /* å®é™…æ”¯å‡ºç¼–è¾‘é¢æ¿ */
        .actual-expense-panel {
            padding: 15px 30px;
            background-color: #fff8e1;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* è¡¨æ ¼åŒºåŸŸ */
        .table-section {
            padding: 30px;
        }

        .section-title {
            font-size: 20px;
            color: #2c5364;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #2c5364;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background-color: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        th {
            background-color: #e9f0f5;
            color: #2c5364;
            padding: 14px;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 2px solid #dce6ed;
            white-space: nowrap;
        }

        td {
            padding: 14px;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #f0f4f8;
            white-space: nowrap;
        }

        tr:hover {
            background-color: #f8fafc;
            transition: background-color 0.2s;
        }

        input[type="number"] {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #dce6ed;
            border-radius: 6px;
            outline: none;
            font-size: 14px;
            color: #333;
            transition: all 0.2s;
        }

        input[type="number"]:focus {
            border-color: #2c5364;
            box-shadow: 0 0 0 2px rgba(44, 83, 100, 0.1);
            transform: translateY(-1px);
        }

        select {
            padding: 8px 12px;
            border: 1px solid #dce6ed;
            border-radius: 6px;
            outline: none;
            font-size: 14px;
            color: #333;
            background-color: #fff;
            width: 120px;
            transition: all 0.2s;
        }

        select:focus {
            border-color: #2c5364;
            box-shadow: 0 0 0 2px rgba(44, 83, 100, 0.1);
            transform: translateY(-1px);
        }

        .total-row {
            background-color: #f0f4f8;
            font-weight: 600;
            color: #2c5364;
        }

        .core-item {
            background-color: #f8fafc;
        }

        .risk-red {
            background-color: #ffebee;
            color: #c62828;
            font-weight: 600;
        }

        .risk-yellow {
            background-color: #fff8e1;
            color: #f57f17;
            font-weight: 600;
        }

        .safe {
            background-color: #e8f5e9;
            color: #2e7d32;
            font-weight: 600;
        }

        .result-box {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            flex: 1;
            min-width: 250px;
            padding: 22px;
            background-color: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid #2c5364;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .result-card h3 {
            font-size: 16px;
            color: #2c5364;
            margin-bottom: 12px;
        }

        .result-card .value {
            font-size: 26px;
            font-weight: 600;
            color: #333;
        }

        .result-card .desc {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
        }

        /* å¤šæœˆä»½æ±‡æ€»è¡¨æ ¼æ ·å¼ */
        .multi-month-table {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        /* æ˜ç»†é¡¹ç¼–è¾‘æ ·å¼ */
        .item-name-edit {
            border: none;
            background: transparent;
            font-size: 14px;
            color: #333;
            width: 100%;
            outline: none;
            cursor: text;
        }

        .item-name-edit:focus {
            border-bottom: 1px solid #2c5364;
        }

        /* å®é™…æ”¯å‡ºè¡¨æ ¼æ ·å¼ */
        .actual-expense-table td {
            background-color: #fff8e1;
        }
        
        /* ==================== æ‰‹æœºç«¯ä¸“ç”¨æ ·å¼ ==================== */
        @media (max-width: 768px) {
            /* åŸºç¡€è°ƒæ•´ */
            body {
                padding: 0;
                background-color: #2c5364;
            }
            
            .container {
                max-width: 100%;
                border-radius: 0;
                box-shadow: none;
                min-height: 100vh;
                display: none; /* é»˜è®¤éšè—æ¡Œé¢ç‰ˆ */
            }
            
            /* æ˜¾ç¤ºæ‰‹æœºç‰ˆå®¹å™¨ */
            .mobile-container {
                display: block;
                min-height: 100vh;
                background: #f5f7fa;
            }
            
            /* æ‰‹æœºç‰ˆå¤´éƒ¨ */
            .mobile-header {
                background: linear-gradient(135deg, #2c5364, #203a43);
                color: white;
                padding: 20px 15px;
                text-align: center;
                position: sticky;
                top: 0;
                z-index: 100;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            
            .mobile-header h1 {
                font-size: 20px;
                margin-bottom: 5px;
                font-weight: 600;
            }
            
            .mobile-header p {
                font-size: 12px;
                opacity: 0.9;
            }
            
            /* åº•éƒ¨å¯¼èˆªæ  */
            .mobile-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                display: flex;
                justify-content: space-around;
                padding: 10px 0;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                z-index: 100;
            }
            
            .nav-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 8px 15px;
                color: #666;
                text-decoration: none;
                font-size: 12px;
                border-radius: 8px;
                transition: all 0.3s;
                flex: 1;
                max-width: 25%;
            }
            
            .nav-item.active {
                background: #e9f0f5;
                color: #2c5364;
                transform: translateY(-5px);
            }
            
            .nav-icon {
                font-size: 22px;
                margin-bottom: 4px;
            }
            
            /* æ‰‹æœºç‰ˆå†…å®¹åŒºåŸŸ */
            .mobile-content {
                padding: 15px;
                padding-bottom: 80px; /* ä¸ºåº•éƒ¨å¯¼èˆªç•™ç©ºé—´ */
                max-width: 100%;
                overflow-x: hidden;
            }
            
            /* æ‰‹æœºç‰ˆå¡ç‰‡ */
            .mobile-card {
                background: white;
                border-radius: 15px;
                padding: 20px;
                margin-bottom: 15px;
                box-shadow: 0 3px 15px rgba(0,0,0,0.08);
            }
            
            .card-title {
                font-size: 18px;
                color: #2c5364;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 2px solid #e9f0f5;
                font-weight: 600;
            }
            
            /* æ‰‹æœºç‰ˆè¡¨å•å…ƒç´  */
            .mobile-form-group {
                margin-bottom: 20px;
            }
            
            .mobile-form-group label {
                display: block;
                font-size: 14px;
                color: #2c5364;
                margin-bottom: 8px;
                font-weight: 600;
            }
            
            .mobile-input, .mobile-select {
                width: 100%;
                padding: 15px;
                border: 2px solid #e9f0f5;
                border-radius: 10px;
                font-size: 16px;
                background: white;
                color: #333;
                transition: all 0.3s;
            }
            
            .mobile-input:focus, .mobile-select:focus {
                border-color: #2c5364;
                outline: none;
                box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.1);
            }
            
            /* æ‰‹æœºç‰ˆæŒ‰é’® */
            .mobile-btn {
                width: 100%;
                padding: 16px;
                background: #2c5364;
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                margin-top: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            }
            
            .mobile-btn-primary {
                background: linear-gradient(135deg, #2c5364, #203a43);
            }
            
            .mobile-btn-success {
                background: linear-gradient(135deg, #2e7d32, #1b5e20);
            }
            
            .mobile-btn-danger {
                background: linear-gradient(135deg, #c62828, #8e0000);
            }
            
            .mobile-btn-warning {
                background: linear-gradient(135deg, #f57f17, #e65100);
            }
            
            .mobile-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }
            
            /* æ‰‹æœºç‰ˆè¡¨æ ¼ */
            .mobile-table-container {
                overflow-x: auto;
                margin: 15px 0;
                border-radius: 10px;
            }
            
            .mobile-table {
                width: 100%;
                min-width: 600px;
                background: white;
                border-radius: 10px;
                overflow: hidden;
            }
            
            .mobile-table th {
                background: #e9f0f5;
                color: #2c5364;
                padding: 12px 10px;
                font-size: 13px;
                font-weight: 600;
                white-space: nowrap;
            }
            
            .mobile-table td {
                padding: 12px 10px;
                font-size: 13px;
                border-bottom: 1px solid #f0f4f8;
            }
            
            .mobile-table input[type="number"] {
                width: 80px;
                padding: 8px;
                font-size: 14px;
            }
            
            /* æ‰‹æœºç‰ˆæŠ˜å é¢æ¿ */
            .mobile-collapse {
                margin-bottom: 15px;
            }
            
            .mobile-collapse-header {
                background: #f8fafc;
                padding: 15px;
                border-radius: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                cursor: pointer;
                border: 2px solid #e9f0f5;
            }
            
            .mobile-collapse-title {
                font-size: 16px;
                color: #2c5364;
                font-weight: 600;
            }
            
            .mobile-collapse-content {
                padding: 15px;
                background: white;
                border-radius: 0 0 10px 10px;
                margin-top: -5px;
                border: 2px solid #e9f0f5;
                border-top: none;
            }
            
            /* ç»Ÿè®¡æ•°æ®å¡ç‰‡ */
            .stats-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin: 15px 0;
            }
            
            .stat-card {
                background: white;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            }
            
            .stat-value {
                font-size: 24px;
                font-weight: 700;
                color: #2c5364;
                margin: 10px 0;
            }
            
            .stat-label {
                font-size: 12px;
                color: #666;
            }
            
            /* å¿«é€Ÿæ“ä½œæŒ‰é’®ç»„ */
            .quick-actions {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin: 20px 0;
            }
            
            .quick-btn {
                padding: 15px;
                background: white;
                border: 2px solid #e9f0f5;
                border-radius: 10px;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                transition: all 0.3s;
            }
            
            .quick-btn:hover {
                border-color: #2c5364;
                transform: translateY(-3px);
            }
            
            .quick-icon {
                font-size: 24px;
                margin-bottom: 8px;
                color: #2c5364;
            }
            
            /* æ¶ˆæ¯æç¤º */
            .mobile-toast {
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(44, 83, 100, 0.95);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 1000;
                display: none;
                animation: slideDown 0.3s ease;
            }
            
            @keyframes slideDown {
                from {
                    transform: translate(-50%, -20px);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, 0);
                    opacity: 1;
                }
            }
            
            /* åŠ è½½æŒ‡ç¤ºå™¨ */
            .mobile-loading {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(255,255,255,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                display: none;
            }
            
            .spinner {
                width: 50px;
                height: 50px;
                border: 5px solid #e9f0f5;
                border-top: 5px solid #2c5364;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            /* éšè—æ¡Œé¢å…ƒç´  */
            .desktop-only {
                display: none !important;
            }
        }
        
        /* ==================== æ¡Œé¢ç«¯æ ·å¼ ==================== */
        @media (min-width: 769px) {
            .mobile-container,
            .mobile-header,
            .mobile-nav,
            .mobile-content,
            .mobile-only {
                display: none !important;
            }
            
            .container {
                display: block !important;
            }
        }
        
        /* åˆ‡æ¢æŒ‰é’® */
        .view-switcher {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: #2c5364;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .view-switcher {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- æ¡Œé¢ç‰ˆå®¹å™¨ -->
    <div class="container" id="desktop-view">
        <div class="header">
            <h1>å¤šæœˆä»½æ‰¹é‡æŸ¥çœ‹ + è‡ªå®šä¹‰æ˜ç»† + é€‰æ‹©æ€§æ‰¹é‡å¡«å…… è–ªé…¬è®¡åˆ’è¡¨</h1>
            <p>è·¨å¹´ä»½æŸ¥çœ‹ | ä¸‰ç±»æ˜ç»†æ±‡æ€» | è‡ªå®šä¹‰å¢åˆ /ä¿®æ”¹æ˜ç»† | é€‰æ‹©æ€§æ‰¹é‡å¡«å…… | éå›ºå®šé¡¹å®é™…æ”¯å‡ºç¼–è¾‘ | æ•°æ®æœ¬åœ°ä¿å­˜</p>
        </div>

        <!-- 1. æ‰¹é‡æœˆä»½é€‰æ‹©é¢æ¿ -->
        <div class="collapse-module">
            <div class="collapse-header" id="header-batchFilter">
                <div class="collapse-title">æ‰¹é‡æœˆä»½é€‰æ‹©ï¼ˆæ”¯æŒè·¨å¹´ä»½ï¼‰</div>
                <button class="collapse-btn" id="btn-batchFilter"></button>
            </div>
            <div class="collapse-content" id="content-batchFilter">
                <div class="batch-filter">
                    <div class="filter-item">
                        <label for="start-year">å¼€å§‹å¹´ä»½ï¼š</label>
                        <select id="start-year">
                            <option value="2024">2024</option>
                            <option value="2025" selected>2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="start-month">å¼€å§‹æœˆä»½ï¼š</label>
                        <select id="start-month">
                            <option value="1">1æœˆ</option>
                            <option value="2">2æœˆ</option>
                            <option value="3">3æœˆ</option>
                            <option value="4">4æœˆ</option>
                            <option value="5">5æœˆ</option>
                            <option value="6">6æœˆ</option>
                            <option value="7">7æœˆ</option>
                            <option value="8">8æœˆ</option>
                            <option value="9">9æœˆ</option>
                            <option value="10">10æœˆ</option>
                            <option value="11">11æœˆ</option>
                            <option value="12">12æœˆ</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="end-year">ç»“æŸå¹´ä»½ï¼š</label>
                        <select id="end-year">
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="end-month">ç»“æŸæœˆä»½ï¼š</label>
                        <select id="end-month">
                            <option value="1">1æœˆ</option>
                            <option value="2">2æœˆ</option>
                            <option value="3">3æœˆ</option>
                            <option value="4">4æœˆ</option>
                            <option value="5">5æœˆ</option>
                            <option value="6">6æœˆ</option>
                            <option value="7">7æœˆ</option>
                            <option value="8">8æœˆ</option>
                            <option value="9">9æœˆ</option>
                            <option value="10">10æœˆ</option>
                            <option value="11">11æœˆ</option>
                            <option value="12" selected>12æœˆ</option>
                        </select>
                    </div>
                    <button class="btn" id="btn-loadBatch">åŠ è½½æ‰¹é‡æœˆä»½æ•°æ®</button>
                    <button class="btn btn-save" id="btn-saveData">ä¿å­˜å½“å‰æ•°æ®</button>
                    <div class="view-tip" id="tip-batch">å½“å‰æ‰¹é‡æŸ¥çœ‹ï¼š2025å¹´1æœˆ - 2026å¹´12æœˆ æ•°æ®</div>
                </div>
            </div>
        </div>

        <!-- 2. æ‰¹é‡å¡«å……é¢æ¿ -->
        <div class="collapse-module">
            <div class="collapse-header" id="header-batchFill">
                <div class="collapse-title">å›ºå®šé¡¹é€‰æ‹©æ€§æ‰¹é‡å¡«å……</div>
                <button class="collapse-btn" id="btn-batchFill"></button>
            </div>
            <div class="collapse-content" id="content-batchFill">
                <div class="batch-fill-panel">
                    <div class="batch-fill-title">å›ºå®šé¡¹é€‰æ‹©æ€§æ‰¹é‡å¡«å……ï¼š</div>
                    <div class="custom-item">
                        <label>å¡«å……è§„åˆ™ï¼š</label>
                        <select id="select-fillRule">
                            <option value="all">æ‰€æœ‰æœˆä»½ï¼ˆç»Ÿä¸€é‡‘é¢ï¼‰</option>
                            <option value="odd-even">å•åŒæœˆï¼ˆå·®å¼‚åŒ–é‡‘é¢ï¼‰</option>
                            <option value="quarter">å­£åº¦ï¼ˆå·®å¼‚åŒ–é‡‘é¢ï¼‰</option>
                        </select>
                    </div>
                    <div class="custom-item" id="panel-all" style="display: flex;">
                        <label>ç»Ÿä¸€é‡‘é¢ï¼š</label>
                        <input type="number" id="input-all" placeholder="è¾“å…¥å¡«å……é‡‘é¢" min="0" step="0.01">
                    </div>
                    <div class="custom-item" id="panel-oddEven" style="display: none;">
                        <label>å•æœˆé‡‘é¢ï¼š</label>
                        <input type="number" id="input-odd" placeholder="å•æœˆé‡‘é¢" min="0" step="0.01">
                        <label>åŒæœˆé‡‘é¢ï¼š</label>
                        <input type="number" id="input-even" placeholder="åŒæœˆé‡‘é¢" min="0" step="0.01">
                    </div>
                    <div class="custom-item" id="panel-quarter" style="display: none;">
                        <label>1-3æœˆï¼š</label>
                        <input type="number" id="input-q1" placeholder="Q1é‡‘é¢" min="0" step="0.01">
                        <label>4-6æœˆï¼š</label>
                        <input type="number" id="input-q2" placeholder="Q2é‡‘é¢" min="0" step="0.01">
                        <label>7-9æœˆï¼š</label>
                        <input type="number" id="input-q3" placeholder="Q3é‡‘é¢" min="0" step="0.01">
                        <label>10-12æœˆï¼š</label>
                        <input type="number" id="input-q4" placeholder="Q4é‡‘é¢" min="0" step="0.01">
                    </div>
                    <button class="btn btn-batch" id="btn-doFill">æ‰§è¡Œæ‰¹é‡å¡«å……</button>
                    <span style="font-size:12px;color:#666;">ï¼ˆå…ˆé€‰ä¸­è¦å¡«å……çš„å›ºå®šæ˜ç»†è¡Œï¼Œå†é€‰æ‹©è§„åˆ™æ‰§è¡Œå¡«å……ï¼‰</span>
                </div>
            </div>
        </div>

        <!-- 3. è‡ªå®šä¹‰æ˜ç»†é¡¹é¢æ¿ -->
        <div class="collapse-module">
            <div class="collapse-header" id="header-customItem">
                <div class="collapse-title">è‡ªå®šä¹‰æ˜ç»†é¡¹ç®¡ç†</div>
                <button class="collapse-btn" id="btn-customItem"></button>
            </div>
            <div class="collapse-content" id="content-customItem">
                <div class="custom-item-panel">
                    <div class="custom-item">
                        <label>æ–°å¢æ˜ç»†ï¼š</label>
                        <select id="select-itemType">
                            <option value="income">æ”¶å…¥é¡¹</option>
                            <option value="expense">æ”¯å‡ºé¡¹</option>
                            <option value="debt">è´Ÿå€ºé¡¹</option>
                        </select>
                        <input type="text" id="input-itemName" placeholder="è¾“å…¥æ˜ç»†åç§°ï¼ˆå¦‚ï¼šå¹´ç»ˆå¥–ï¼‰">
                        <select id="select-itemFixed">
                            <option value="å›ºå®š">å›ºå®š</option>
                            <option value="éå›ºå®š">éå›ºå®š</option>
                        </select>
                        <button class="btn btn-add" id="btn-addItem">æ·»åŠ æ˜ç»†</button>
                    </div>
                    <div class="custom-item">
                        <label>åˆ é™¤é€‰ä¸­æ˜ç»†ï¼š</label>
                        <button class="btn btn-del" id="btn-delItem">åˆ é™¤æ˜ç»†</button>
                        <span style="font-size:12px;color:#666;">ï¼ˆç‚¹å‡»æ˜ç»†è¡Œé€‰ä¸­ååˆ é™¤ï¼‰</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-section">
            <!-- 4. å¤šæœˆä»½æ˜ç»†æ±‡æ€»è¡¨ -->
            <div class="collapse-module">
                <div class="collapse-header" id="header-summaryTable">
                    <div class="collapse-title">å¤šæœˆä»½æ˜ç»†æ±‡æ€»è¡¨ï¼ˆæ”¶å…¥/æ”¯å‡º/è´Ÿå€ºåˆå¹¶ï¼‰</div>
                    <button class="collapse-btn" id="btn-summaryTable"></button>
                </div>
                <div class="collapse-content" id="content-summaryTable">
                    <div class="section-title">
                        <span>ä¸€ã€å¤šæœˆä»½æ˜ç»†æ±‡æ€»è¡¨ï¼ˆæ”¶å…¥/æ”¯å‡º/è´Ÿå€ºåˆå¹¶ï¼‰</span>
                        <span style="font-size:14px;color:#666;">ç‚¹å‡»æ˜ç»†åç§°å¯ç›´æ¥ä¿®æ”¹ | å›ºå®šé¡¹æ”¯æŒæ‰¹é‡å¡«å……</span>
                    </div>
                    <div class="multi-month-table">
                        <table id="table-summary">
                            <thead>
                                <tr id="tr-monthTh">
                                    <th>æ˜ç»†ç±»å‹</th>
                                    <th>æ˜ç»†åç§°</th>
                                    <th>å›ºå®š/éå›ºå®š</th>
                                    <!-- æœˆä»½åˆ—åŠ¨æ€ç”Ÿæˆï¼ˆæ ¼å¼ï¼šå¹´-æœˆï¼‰ -->
                                    <th>æ‰¹é‡æ€»è®¡</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-items">
                                <!-- åŠ¨æ€ç”Ÿæˆæ˜ç»†è¡Œ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 5. å®é™…æ”¯å‡ºç¼–è¾‘é¢æ¿ -->
            <div class="collapse-module">
                <div class="collapse-header" id="header-actualExpense">
                    <div class="collapse-title">éå›ºå®šé¡¹å®é™…æ”¯å‡ºç¼–è¾‘ï¼ˆå¯¹æ¯”+ä¸€é”®å¡«å……ï¼‰</div>
                    <button class="collapse-btn" id="btn-actualExpense"></button>
                </div>
                <div class="collapse-content" id="content-actualExpense">
                    <div class="actual-expense-panel">
                        <div class="batch-fill-title">é€‰æ‹©æœˆä»½ç¼–è¾‘éå›ºå®šé¡¹å®é™…æ”¯å‡ºï¼š</div>
                        <div class="custom-item">
                            <select id="select-editMonth" disabled>
                                <option value="">è¯·å…ˆåŠ è½½æœˆä»½æ•°æ®</option>
                            </select>
                            <button class="btn" id="btn-loadEditMonth">åŠ è½½è¯¥æœˆæ•°æ®</button>
                            <button class="btn btn-fillToPlan" id="btn-fillToPlan">ä¸€é”®å¡«å……åˆ°è§„åˆ’è¡¨</button>
                        </div>
                        <span style="font-size:12px;color:#666;">ï¼ˆåŠ è½½åç¼–è¾‘å®é™…æ”¯å‡ºï¼Œå¡«å……ååŒæ­¥åˆ°å¯¹åº”å¹´æœˆè§„åˆ’æ•°æ®ï¼‰</span>
                    </div>
                    <div class="table-section">
                        <div class="section-title">
                            <span>è¯¥æœˆéå›ºå®šé¡¹æ˜ç»†ï¼ˆè§„åˆ’ vs å®é™…ï¼‰</span>
                        </div>
                        <div class="multi-month-table">
                            <table id="table-actualExpense" class="actual-expense-table">
                                <thead>
                                    <tr>
                                        <th>æ˜ç»†ç±»å‹</th>
                                        <th>æ˜ç»†åç§°</th>
                                        <th>è§„åˆ’é‡‘é¢</th>
                                        <th>å®é™…é‡‘é¢</th>
                                        <th>åå·®é‡‘é¢ï¼ˆå®é™…-è§„åˆ’ï¼‰</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody-actualExpense">
                                    <tr>
                                        <td colspan="5" style="text-align: center; color: #666;">è¯·å…ˆé€‰æ‹©æœˆä»½å¹¶åŠ è½½æ•°æ®</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. å¤šæœˆä»½æ”¶æ”¯ç»“ä½™æ±‡æ€» -->
            <div class="collapse-module">
                <div class="collapse-header" id="header-balanceTable">
                    <div class="collapse-title">å¤šæœˆä»½æ”¶æ”¯ç»“ä½™æ±‡æ€»</div>
                    <button class="collapse-btn" id="btn-balanceTable"></button>
                </div>
                <div class="collapse-content" id="content-balanceTable">
                    <div class="section-title">äºŒã€å¤šæœˆä»½æ”¶æ”¯ç»“ä½™æ±‡æ€»</div>
                    <div class="multi-month-table">
                        <table id="table-balance">
                            <thead>
                                <tr id="tr-balanceTh">
                                    <th>ç»Ÿè®¡é¡¹ç›®</th>
                                    <!-- æœˆä»½åˆ—åŠ¨æ€ç”Ÿæˆï¼ˆæ ¼å¼ï¼šå¹´-æœˆï¼‰ -->
                                    <th>æ‰¹é‡æ€»è®¡</th>
                                    <th>çŠ¶æ€æç¤º</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-balance">
                                <tr id="tr-income">
                                    <td>æ€»æ”¶å…¥</td>
                                    <!-- æœˆä»½åˆ—åŠ¨æ€å¡«å…… -->
                                    <td id="td-totalIncome">0.00</td>
                                    <td>-</td>
                                </tr>
                                <tr id="tr-expense">
                                    <td>æ€»æ”¯å‡º</td>
                                    <!-- æœˆä»½åˆ—åŠ¨æ€å¡«å…… -->
                                    <td id="td-totalExpense">0.00</td>
                                    <td>-</td>
                                </tr>
                                <tr id="tr-debt">
                                    <td>æ€»è´Ÿå€ºè¿˜æ¬¾</td>
                                    <!-- æœˆä»½åˆ—åŠ¨æ€å¡«å…… -->
                                    <td id="td-totalDebt">0.00</td>
                                    <td>-</td>
                                </tr>
                                <tr class="core-item" id="tr-balance">
                                    <td>æ”¶æ”¯ç»“ä½™ï¼ˆæ”¶å…¥-æ”¯å‡ºï¼‰</td>
                                    <!-- æœˆä»½åˆ—åŠ¨æ€å¡«å…… -->
                                    <td id="td-balance">0.00</td>
                                    <td id="td-balanceStatus">--</td>
                                </tr>
                                <tr class="core-item" id="tr-disposable">
                                    <td>æœ€ç»ˆå¯æ”¯é…ä½™é¢ï¼ˆç»“ä½™-è´Ÿå€ºï¼‰</td>
                                    <!-- æœˆä»½åˆ—åŠ¨æ€å¡«å…… -->
                                    <td id="td-disposable">0.00</td>
                                    <td id="td-disposableStatus">--</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 7. å¯è§†åŒ–ç»“æœå¡ç‰‡ -->
            <div class="collapse-module">
                <div class="collapse-header" id="header-resultCard">
                    <div class="collapse-title">æ•°æ®å¯è§†åŒ–æ±‡æ€»å¡ç‰‡</div>
                    <button class="collapse-btn" id="btn-resultCard"></button>
                </div>
                <div class="collapse-content" id="content-resultCard">
                    <div class="result-box">
                        <div class="result-card">
                            <h3>æ‰¹é‡æ€»æ”¶â¼Š</h3>
                            <div class="value" id="card-income">Â¥ 0.00</div>
                            <div class="desc">æ‰€é€‰æœˆä»½æ”¶å…¥æ€»å’Œ</div>
                        </div>
                        <div class="result-card">
                            <h3>æ‰¹é‡æ€»â½€å‡º</h3>
                            <div class="value" id="card-expense">Â¥ 0.00</div>
                            <div class="desc">æ‰€é€‰æœˆä»½æ”¯å‡ºæ€»å’Œ</div>
                        </div>
                        <div class="result-card">
                            <h3>æ‰¹é‡æ€»è´Ÿå€º</h3>
                            <div class="value" id="card-debt">Â¥ 0.00</div>
                            <div class="desc">æ‰€é€‰æœˆä»½è´Ÿå€ºè¿˜æ¬¾æ€»å’Œ</div>
                        </div>
                        <div class="result-card">
                            <h3>æ‰¹é‡æœ€ç»ˆå¯æ”¯é…ä½™é¢</h3>
                            <div class="value" id="card-disposable">Â¥ 0.00</div>
                            <div class="desc">æ‰€é€‰æœˆä»½å¯è‡ªç”±æ”¯é…èµ„é‡‘æ€»å’Œ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰‹æœºç‰ˆå®¹å™¨ -->
    <div class="mobile-container" id="mobile-view">
        <!-- æ‰‹æœºç‰ˆå¤´éƒ¨ -->
        <div class="mobile-header">
            <h1>è–ªé…¬è®¡åˆ’è¡¨</h1>
            <p>è½»æ¾ç®¡ç†ä½ çš„æ”¶å…¥ä¸æ”¯å‡º</p>
        </div>
        
        <!-- æ‰‹æœºç‰ˆå†…å®¹åŒºåŸŸ -->
        <div class="mobile-content" id="mobile-page-content">
            <!-- é¦–é¡µå†…å®¹ä¼šåŠ¨æ€åŠ è½½ -->
        </div>
        
        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <div class="mobile-nav">
            <a href="#" class="nav-item active" data-page="home">
                <span class="nav-icon">ğŸ </span>
                <span>é¦–é¡µ</span>
            </a>
            <a href="#" class="nav-item" data-page="plan">
                <span class="nav-icon">ğŸ“Š</span>
                <span>è®¡åˆ’</span>
            </a>
            <a href="#" class="nav-item" data-page="actual">
                <span class="nav-icon">ğŸ’°</span>
                <span>å®é™…</span>
            </a>
            <a href="#" class="nav-item" data-page="stats">
                <span class="nav-icon">ğŸ“ˆ</span>
                <span>ç»Ÿè®¡</span>
            </a>
            <a href="#" class="nav-item" data-page="settings">
                <span class="nav-icon">âš™ï¸</span>
                <span>è®¾ç½®</span>
            </a>
        </div>
        
        <!-- æ¶ˆæ¯æç¤º -->
        <div class="mobile-toast" id="mobile-toast"></div>
        
        <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
        <div class="mobile-loading" id="mobile-loading">
            <div class="spinner"></div>
        </div>
    </div>
    
    <!-- åˆ‡æ¢è§†å›¾æŒ‰é’® -->
    <button class="view-switcher" id="view-switcher">åˆ‡æ¢è§†å›¾</button>

    <script>
        // ========== å…¨å±€é…ç½® ==========
        let globalConfig = {
            startYear: "2025",
            endYear: "2026",
            startMonth: 1,
            endMonth: 12,
            months: [],
            itemTypes: {
                income: { name: "æ”¶å…¥", items: [
                    { id: "in1", name: "åŸºæœ¬å·¥èµ„", isFixed: "å›ºå®š", planValues: {}, actualValues: {} },
                    { id: "in2", name: "å›ºå®šè¡¥è´´", isFixed: "å›ºå®š", planValues: {}, actualValues: {} },
                    { id: "in3", name: "ç»©æ•ˆå¥–é‡‘", isFixed: "éå›ºå®š", planValues: {}, actualValues: {} },
                    { id: "in4", name: "é”€å”®ææˆ", isFixed: "éå›ºå®š", planValues: {}, actualValues: {} },
                    { id: "in5", name: "å¹´ç»ˆå¥–é‡‘", isFixed: "éå›ºå®š", planValues: {}, actualValues: {} }
                ]},
                expense: { name: "æ”¯å‡º", items: [
                    { id: "ex1", name: "æˆ¿ç§Ÿ/æˆ¿è´·", isFixed: "å›ºå®š", planValues: {}, actualValues: {} },
                    { id: "ex2", name: "æ°´ç”µç‡ƒæ°”è´¹", isFixed: "å›ºå®š", planValues: {}, actualValues: {} },
                    { id: "ex3", name: "äº”é™©ä¸€é‡‘", isFixed: "å›ºå®š", planValues: {}, actualValues: {} },
                    { id: "ex4", name: "é¤é¥®å¨±ä¹", isFixed: "éå›ºå®š", planValues: {}, actualValues: {} },
                    { id: "ex5", name: "è´­ç‰©æ¶ˆè´¹", isFixed: "éå›ºå®š", planValues: {}, actualValues: {} }
                ]},
                debt: { name: "è´Ÿå€º", items: [
                    { id: "dt1", name: "è½¦è´·æœˆä¾›", isFixed: "å›ºå®š", planValues: {}, actualValues: {} },
                    { id: "dt2", name: "ä¿¡ç”¨å¡è¿˜æ¬¾", isFixed: "å›ºå®š", planValues: {}, actualValues: {} },
                    { id: "dt3", name: "ä¸´æ—¶è´¦å•", isFixed: "éå›ºå®š", planValues: {}, actualValues: {} }
                ]}
            },
            currentEditMonth: "",
            currentMobilePage: "home"
        };

        // ========== æ‰‹æœºç‰ˆé¡µé¢ç®¡ç† ==========
        const mobilePages = {
            home: `
                <div class="mobile-card">
                    <h2 class="card-title">æ¬¢è¿ä½¿ç”¨è–ªé…¬è®¡åˆ’è¡¨</h2>
                    <p>è½»æ¾ç®¡ç†ä½ çš„æ”¶å…¥ã€æ”¯å‡ºå’Œè´Ÿå€ºï¼Œåˆ¶å®šåˆç†çš„è´¢åŠ¡è®¡åˆ’ã€‚</p>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="showMobilePage('plan')">
                            <span class="quick-icon">ğŸ“Š</span>
                            <span>å¼€å§‹è®¡åˆ’</span>
                        </button>
                        <button class="quick-btn" onclick="showMobilePage('actual')">
                            <span class="quick-icon">ğŸ’°</span>
                            <span>è®°å½•å®é™…</span>
                        </button>
                        <button class="quick-btn" onclick="showMobilePage('stats')">
                            <span class="quick-icon">ğŸ“ˆ</span>
                            <span>æŸ¥çœ‹ç»Ÿè®¡</span>
                        </button>
                        <button class="quick-btn" onclick="loadBatchData()">
                            <span class="quick-icon">ğŸ”„</span>
                            <span>åŠ è½½æ•°æ®</span>
                        </button>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h2 class="card-title">å¿«é€Ÿç»Ÿè®¡æ•°æ®</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">æ€»æ”¶å…¥</div>
                            <div class="stat-value" id="mobile-income">Â¥0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ€»æ”¯å‡º</div>
                            <div class="stat-value" id="mobile-expense">Â¥0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ€»è´Ÿå€º</div>
                            <div class="stat-value" id="mobile-debt">Â¥0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">å¯æ”¯é…ä½™é¢</div>
                            <div class="stat-value" id="mobile-balance">Â¥0</div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h2 class="card-title">æœˆä»½é€‰æ‹©</h2>
                    <div class="mobile-form-group">
                        <label>å¼€å§‹æ—¶é—´</label>
                        <div style="display: flex; gap: 10px;">
                            <select class="mobile-select" id="mobile-start-year">
                                <option value="2024">2024</option>
                                <option value="2025" selected>2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                            </select>
                            <select class="mobile-select" id="mobile-start-month">
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mobile-form-group">
                        <label>ç»“æŸæ—¶é—´</label>
                        <div style="display: flex; gap: 10px;">
                            <select class="mobile-select" id="mobile-end-year">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026" selected>2026</option>
                                <option value="2027">2027</option>
                            </select>
                            <select class="mobile-select" id="mobile-end-month">
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12" selected>12æœˆ</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="mobile-btn mobile-btn-primary" onclick="loadBatchData()">
                        ğŸ“… åŠ è½½æœˆä»½æ•°æ®
                    </button>
                    <button class="mobile-btn mobile-btn-success" onclick="saveData()">
                        ğŸ’¾ ä¿å­˜å½“å‰æ•°æ®
                    </button>
                </div>
            `,
            
            plan: `
                <div class="mobile-card">
                    <h2 class="card-title">æœˆåº¦è®¡åˆ’</h2>
                    
                    <div class="mobile-collapse">
                        <div class="mobile-collapse-header" onclick="toggleMobileCollapse(this)">
                            <div class="mobile-collapse-title">æ‰¹é‡å¡«å……</div>
                            <span>â–¼</span>
                        </div>
                        <div class="mobile-collapse-content" style="display: none;">
                            <div class="mobile-form-group">
                                <label>å¡«å……è§„åˆ™</label>
                                <select class="mobile-select" id="mobile-fillRule">
                                    <option value="all">æ‰€æœ‰æœˆä»½ç»Ÿä¸€</option>
                                    <option value="odd-even">å•åŒæœˆä¸åŒ</option>
                                    <option value="quarter">æŒ‰å­£åº¦ä¸åŒ</option>
                                </select>
                            </div>
                            
                            <div id="mobile-fill-all">
                                <div class="mobile-form-group">
                                    <label>ç»Ÿä¸€é‡‘é¢</label>
                                    <input type="number" class="mobile-input" id="mobile-input-all" placeholder="è¾“å…¥é‡‘é¢">
                                </div>
                            </div>
                            
                            <div id="mobile-fill-oddEven" style="display: none;">
                                <div class="mobile-form-group">
                                    <label>å•æœˆé‡‘é¢</label>
                                    <input type="number" class="mobile-input" id="mobile-input-odd" placeholder="å•æœˆé‡‘é¢">
                                </div>
                                <div class="mobile-form-group">
                                    <label>åŒæœˆé‡‘é¢</label>
                                    <input type="number" class="mobile-input" id="mobile-input-even" placeholder="åŒæœˆé‡‘é¢">
                                </div>
                            </div>
                            
                            <div id="mobile-fill-quarter" style="display: none;">
                                <div class="mobile-form-group">
                                    <label>1-3æœˆé‡‘é¢</label>
                                    <input type="number" class="mobile-input" id="mobile-input-q1" placeholder="Q1é‡‘é¢">
                                </div>
                                <div class="mobile-form-group">
                                    <label>4-6æœˆé‡‘é¢</label>
                                    <input type="number" class="mobile-input" id="mobile-input-q2" placeholder="Q2é‡‘é¢">
                                </div>
                                <div class="mobile-form-group">
                                    <label>7-9æœˆé‡‘é¢</label>
                                    <input type="number" class="mobile-input" id="mobile-input-q3" placeholder="Q3é‡‘é¢">
                                </div>
                                <div class="mobile-form-group">
                                    <label>10-12æœˆé‡‘é¢</label>
                                    <input type="number" class="mobile-input" id="mobile-input-q4" placeholder="Q4é‡‘é¢">
                                </div>
                            </div>
                            
                            <button class="mobile-btn mobile-btn-primary" onclick="doMobileBatchFill()">
                                ğŸš€ æ‰§è¡Œæ‰¹é‡å¡«å……
                            </button>
                        </div>
                    </div>
                    
                    <div class="mobile-collapse">
                        <div class="mobile-collapse-header" onclick="toggleMobileCollapse(this)">
                            <div class="mobile-collapse-title">è‡ªå®šä¹‰æ˜ç»†</div>
                            <span>â–¼</span>
                        </div>
                        <div class="mobile-collapse-content" style="display: none;">
                            <div class="mobile-form-group">
                                <label>æ˜ç»†ç±»å‹</label>
                                <select class="mobile-select" id="mobile-itemType">
                                    <option value="income">æ”¶å…¥é¡¹</option>
                                    <option value="expense">æ”¯å‡ºé¡¹</option>
                                    <option value="debt">è´Ÿå€ºé¡¹</option>
                                </select>
                            </div>
                            
                            <div class="mobile-form-group">
                                <label>æ˜ç»†åç§°</label>
                                <input type="text" class="mobile-input" id="mobile-itemName" placeholder="å¦‚ï¼šå¹´ç»ˆå¥–">
                            </div>
                            
                            <div class="mobile-form-group">
                                <label>ç±»å‹</label>
                                <select class="mobile-select" id="mobile-itemFixed">
                                    <option value="å›ºå®š">å›ºå®š</option>
                                    <option value="éå›ºå®š">éå›ºå®š</option>
                                </select>
                            </div>
                            
                            <button class="mobile-btn mobile-btn-success" onclick="addMobileItem()">
                                â• æ·»åŠ æ˜ç»†
                            </button>
                            <button class="mobile-btn mobile-btn-danger" onclick="deleteMobileItem()">
                                ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h2 class="card-title">è®¡åˆ’æ˜ç»†è¡¨</h2>
                    <div class="mobile-table-container">
                        <table class="mobile-table" id="mobile-plan-table">
                            <thead>
                                <tr>
                                    <th>ç±»å‹</th>
                                    <th>åç§°</th>
                                    <th>é‡‘é¢</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="mobile-plan-tbody">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                                        è¯·å…ˆåŠ è½½æœˆä»½æ•°æ®
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            
            actual: `
                <div class="mobile-card">
                    <h2 class="card-title">å®é™…æ”¯å‡ºç¼–è¾‘</h2>
                    
                    <div class="mobile-form-group">
                        <label>é€‰æ‹©æœˆä»½</label>
                        <select class="mobile-select" id="mobile-editMonth" onchange="loadMobileActualData()">
                            <option value="">è¯·é€‰æ‹©æœˆä»½</option>
                        </select>
                    </div>
                    
                    <div class="mobile-table-container">
                        <table class="mobile-table" id="mobile-actual-table">
                            <thead>
                                <tr>
                                    <th>åç§°</th>
                                    <th>è®¡åˆ’</th>
                                    <th>å®é™…</th>
                                    <th>åå·®</th>
                                </tr>
                            </thead>
                            <tbody id="mobile-actual-tbody">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                                        è¯·å…ˆé€‰æ‹©æœˆä»½
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <button class="mobile-btn mobile-btn-primary" onclick="fillActualToPlan()">
                        ğŸ“‹ ä¸€é”®å¡«å……åˆ°è®¡åˆ’
                    </button>
                </div>
            `,
            
            stats: `
                <div class="mobile-card">
                    <h2 class="card-title">æ”¶æ”¯ç»Ÿè®¡</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card" style="grid-column: span 2;">
                            <div class="stat-label">æ‰¹é‡æ€»æ”¶å…¥</div>
                            <div class="stat-value" id="mobile-total-income">Â¥0.00</div>
                        </div>
                        <div class="stat-card" style="grid-column: span 2;">
                            <div class="stat-label">æ‰¹é‡æ€»æ”¯å‡º</div>
                            <div class="stat-value" id="mobile-total-expense">Â¥0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ€»è´Ÿå€º</div>
                            <div class="stat-value" id="mobile-total-debt">Â¥0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ”¶æ”¯ç»“ä½™</div>
                            <div class="stat-value" id="mobile-total-balance">Â¥0.00</div>
                        </div>
                        <div class="stat-card" style="grid-column: span 2; background: linear-gradient(135deg, #2c5364, #203a43); color: white;">
                            <div class="stat-label">æœ€ç»ˆå¯æ”¯é…ä½™é¢</div>
                            <div class="stat-value" id="mobile-total-disposable">Â¥0.00</div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h2 class="card-title">æœˆåº¦è¯¦æƒ…</h2>
                    <div class="mobile-table-container">
                        <table class="mobile-table" id="mobile-stats-table">
                            <thead>
                                <tr>
                                    <th>æœˆä»½</th>
                                    <th>æ”¶å…¥</th>
                                    <th>æ”¯å‡º</th>
                                    <th>ç»“ä½™</th>
                                </tr>
                            </thead>
                            <tbody id="mobile-stats-tbody">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                                        æš‚æ— æ•°æ®
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            
            settings: `
                <div class="mobile-card">
                    <h2 class="card-title">åº”ç”¨è®¾ç½®</h2>
                    
                    <div class="mobile-form-group">
                        <button class="mobile-btn mobile-btn-primary" onclick="saveData()">
                            ğŸ’¾ å¤‡ä»½æ•°æ®åˆ°äº‘ç«¯
                        </button>
                    </div>
                    
                    <div class="mobile-form-group">
                        <button class="mobile-btn" onclick="loadSavedData()">
                            ğŸ”„ ä»äº‘ç«¯æ¢å¤æ•°æ®
                        </button>
                    </div>
                    
                    <div class="mobile-form-group">
                        <button class="mobile-btn mobile-btn-danger" onclick="clearAllData()">
                            ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®
                        </button>
                    </div>
                    
                    <div class="mobile-form-group">
                        <button class="mobile-btn" onclick="showMobileToast('æ£€æŸ¥æ›´æ–°ä¸­...')">
                            ğŸ” æ£€æŸ¥æ›´æ–°
                        </button>
                    </div>
                    
                    <div class="mobile-form-group">
                        <button class="mobile-btn" onclick="exportData()">
                            ğŸ“¤ å¯¼å‡ºæ•°æ®
                        </button>
                    </div>
                    
                    <div class="mobile-form-group">
                        <button class="mobile-btn" onclick="importData()">
                            ğŸ“¥ å¯¼å…¥æ•°æ®
                        </button>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h2 class="card-title">å…³äºåº”ç”¨</h2>
                    <p><strong>ç‰ˆæœ¬:</strong> 2.0.0</p>
                    <p><strong>å¼€å‘è€…:</strong> è–ªé…¬è®¡åˆ’è¡¨å›¢é˜Ÿ</p>
                    <p><strong>åŠŸèƒ½:</strong> æ”¶å…¥æ”¯å‡ºç®¡ç†ã€è´¢åŠ¡è§„åˆ’ã€æ•°æ®åˆ†æ</p>
                    <p><strong>å­˜å‚¨:</strong> æ•°æ®ä¿å­˜åœ¨æœ¬åœ°ï¼Œå®‰å…¨å¯é </p>
                    <p><strong>æ”¯æŒ:</strong> æ”¯æŒç¦»çº¿ä½¿ç”¨ï¼ŒPWAåº”ç”¨</p>
                </div>
            `
        };

        // ========== æ‰‹æœºç‰ˆåŠŸèƒ½å‡½æ•° ==========
        function showMobilePage(page) {
            globalConfig.currentMobilePage = page;
            
            // æ›´æ–°å¯¼èˆª
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.nav-item[data-page="${page}"]`).classList.add('active');
            
            // æ˜¾ç¤ºé¡µé¢å†…å®¹
            document.getElementById('mobile-page-content').innerHTML = mobilePages[page];
            
            // é¡µé¢ç‰¹å®šçš„åˆå§‹åŒ–
            if (page === 'plan') {
                initMobilePlanPage();
            } else if (page === 'actual') {
                initMobileActualPage();
            } else if (page === 'stats') {
                initMobileStatsPage();
            } else if (page === 'home') {
                updateMobileStats();
            }
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            document.getElementById('mobile-page-content').scrollTop = 0;
        }

        function toggleMobileCollapse(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('span');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = 'â–²';
            } else {
                content.style.display = 'none';
                icon.textContent = 'â–¼';
            }
        }

        function showMobileToast(message) {
            const toast = document.getElementById('mobile-toast');
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function showLoading(show) {
            document.getElementById('mobile-loading').style.display = show ? 'flex' : 'none';
        }

        // ========== æ‰‹æœºç‰ˆæ•°æ®æ“ä½œ ==========
        function initMonths() {
            globalConfig.months = [];
            let startY = parseInt(globalConfig.startYear);
            let endY = parseInt(globalConfig.endYear);
            let startM = globalConfig.startMonth;
            let endM = globalConfig.endMonth;

            for (let y = startY; y <= endY; y++) {
                let curStartM = (y === startY) ? startM : 1;
                let curEndM = (y === endY) ? endM : 12;
                for (let m = curStartM; m <= curEndM; m++) {
                    let monthKey = `${y}-${m.toString().padStart(2, "0")}`;
                    globalConfig.months.push(monthKey);
                }
            }

            const allItems = [
                ...globalConfig.itemTypes.income.items,
                ...globalConfig.itemTypes.expense.items,
                ...globalConfig.itemTypes.debt.items
            ];
            allItems.forEach(item => {
                globalConfig.months.forEach(monthKey => {
                    if (!item.planValues[monthKey]) item.planValues[monthKey] = "";
                    if (!item.actualValues[monthKey]) item.actualValues[monthKey] = "";
                });
            });

            // æ›´æ–°æ‰‹æœºç‰ˆæœˆä»½é€‰æ‹©
            updateMobileMonthSelect();
        }

        function updateMobileMonthSelect() {
            const select = document.getElementById('mobile-editMonth');
            if (!select) return;
            
            select.innerHTML = '<option value="">è¯·é€‰æ‹©æœˆä»½</option>';
            globalConfig.months.forEach(monthKey => {
                const option = document.createElement('option');
                option.value = monthKey;
                option.textContent = monthKey.replace("-", "å¹´") + "æœˆ";
                select.appendChild(option);
            });
        }

        function loadBatchData() {
            // ä»æ‰‹æœºç‰ˆæ§ä»¶è·å–å€¼
            if (window.innerWidth <= 768) {
                globalConfig.startYear = document.getElementById('mobile-start-year').value;
                globalConfig.startMonth = parseInt(document.getElementById('mobile-start-month').value);
                globalConfig.endYear = document.getElementById('mobile-end-year').value;
                globalConfig.endMonth = parseInt(document.getElementById('mobile-end-month').value);
            } else {
                // æ¡Œé¢ç‰ˆé€»è¾‘ä¿æŒä¸å˜
                globalConfig.startYear = document.getElementById("start-year").value;
                globalConfig.startMonth = parseInt(document.getElementById("start-month").value);
                globalConfig.endYear = document.getElementById("end-year").value;
                globalConfig.endMonth = parseInt(document.getElementById("end-month").value);
            }

            if (parseInt(globalConfig.startYear) > parseInt(globalConfig.endYear) || 
                (parseInt(globalConfig.startYear) === parseInt(globalConfig.endYear) && globalConfig.startMonth > globalConfig.endMonth)) {
                showMobileToast("å¼€å§‹æ—¶é—´ä¸èƒ½æ™šäºç»“æŸæ—¶é—´ï¼");
                return;
            }

            initMonths();
            
            if (window.innerWidth <= 768) {
                updateMobileStats();
                initMobilePlanPage();
                showMobileToast("æ•°æ®åŠ è½½æˆåŠŸï¼");
            } else {
                // æ¡Œé¢ç‰ˆæ›´æ–°
                updateBatchTip();
                generateMonthColumns();
                generateItemRows();
                calculateAll();
            }
        }

        function updateMobileStats() {
            if (window.innerWidth > 768) return;
            
            let totalIncome = 0, totalExpense = 0, totalDebt = 0;
            
            // è®¡ç®—æ€»æ”¶å…¥
            globalConfig.itemTypes.income.items.forEach(item => {
                globalConfig.months.forEach(monthKey => {
                    totalIncome += parseFloat(item.planValues[monthKey] || 0);
                });
            });
            
            // è®¡ç®—æ€»æ”¯å‡º
            globalConfig.itemTypes.expense.items.forEach(item => {
                globalConfig.months.forEach(monthKey => {
                    totalExpense += parseFloat(item.planValues[monthKey] || 0);
                });
            });
            
            // è®¡ç®—æ€»è´Ÿå€º
            globalConfig.itemTypes.debt.items.forEach(item => {
                globalConfig.months.forEach(monthKey => {
                    totalDebt += parseFloat(item.planValues[monthKey] || 0);
                });
            });
            
            const balance = totalIncome - totalExpense;
            const disposable = balance - totalDebt;
            
            // æ›´æ–°æ˜¾ç¤º
            const incomeEl = document.getElementById('mobile-income');
            const expenseEl = document.getElementById('mobile-expense');
            const debtEl = document.getElementById('mobile-debt');
            const balanceEl = document.getElementById('mobile-balance');
            
            if (incomeEl) incomeEl.textContent = 'Â¥' + formatNum(totalIncome);
            if (expenseEl) expenseEl.textContent = 'Â¥' + formatNum(totalExpense);
            if (debtEl) debtEl.textContent = 'Â¥' + formatNum(totalDebt);
            if (balanceEl) balanceEl.textContent = 'Â¥' + formatNum(disposable);
            
            // æ›´æ–°ç»Ÿè®¡é¡µé¢
            const totalIncomeEl = document.getElementById('mobile-total-income');
            const totalExpenseEl = document.getElementById('mobile-total-expense');
            const totalDebtEl = document.getElementById('mobile-total-debt');
            const totalBalanceEl = document.getElementById('mobile-total-balance');
            const totalDisposableEl = document.getElementById('mobile-total-disposable');
            
            if (totalIncomeEl) totalIncomeEl.textContent = 'Â¥' + formatNum(totalIncome);
            if (totalExpenseEl) totalExpenseEl.textContent = 'Â¥' + formatNum(totalExpense);
            if (totalDebtEl) totalDebtEl.textContent = 'Â¥' + formatNum(totalDebt);
            if (totalBalanceEl) totalBalanceEl.textContent = 'Â¥' + formatNum(balance);
            if (totalDisposableEl) totalDisposableEl.textContent = 'Â¥' + formatNum(disposable);
        }

        // ========== æ‰‹æœºç‰ˆè®¡åˆ’é¡µé¢ ==========
        function initMobilePlanPage() {
            // åˆå§‹åŒ–å¡«å……è§„åˆ™åˆ‡æ¢
            const fillRuleSelect = document.getElementById('mobile-fillRule');
            if (fillRuleSelect) {
                fillRuleSelect.onchange = function() {
                    document.getElementById('mobile-fill-all').style.display = 'none';
                    document.getElementById('mobile-fill-oddEven').style.display = 'none';
                    document.getElementById('mobile-fill-quarter').style.display = 'none';
                    
                    if (this.value === 'all') {
                        document.getElementById('mobile-fill-all').style.display = 'block';
                    } else if (this.value === 'odd-even') {
                        document.getElementById('mobile-fill-oddEven').style.display = 'block';
                    } else if (this.value === 'quarter') {
                        document.getElementById('mobile-fill-quarter').style.display = 'block';
                    }
                };
            }
            
            // ç”Ÿæˆè®¡åˆ’è¡¨æ ¼
            generateMobilePlanTable();
        }

        function generateMobilePlanTable() {
            const tbody = document.getElementById('mobile-plan-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (globalConfig.months.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                            è¯·å…ˆåŠ è½½æœˆä»½æ•°æ®
                        </td>
                    </tr>
                `;
                return;
            }
            
            // åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæœˆçš„è®¡åˆ’ï¼ˆç®€åŒ–æ˜¾ç¤ºï¼‰
            const firstMonth = globalConfig.months[0];
            
            // åˆå¹¶æ‰€æœ‰é¡¹ç›®
            const allItems = [];
            for (const typeKey in globalConfig.itemTypes) {
                const type = globalConfig.itemTypes[typeKey];
                type.items.forEach(item => {
                    allItems.push({
                        ...item,
                        typeName: type.name,
                        typeKey: typeKey
                    });
                });
            }
            
            if (allItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                            æš‚æ— æ˜ç»†é¡¹ç›®
                        </td>
                    </tr>
                `;
                return;
            }
            
            allItems.forEach((item, index) => {
                const tr = document.createElement('tr');
                const planValue = parseFloat(item.planValues[firstMonth] || 0);
                
                tr.innerHTML = `
                    <td>${item.typeName}</td>
                    <td>${item.name}</td>
                    <td>
                        <input type="number" 
                               value="${formatNum(planValue)}" 
                               style="width: 80px; padding: 5px;"
                               onchange="updatePlanValue('${item.id}', '${item.typeKey}', '${firstMonth}', this.value)">
                    </td>
                    <td>
                        <button onclick="selectMobileItem(${index})" style="padding: 5px 10px; font-size: 12px;">é€‰æ‹©</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // æ·»åŠ æ€»è®¡è¡Œ
            const totalTr = document.createElement('tr');
            totalTr.className = 'total-row';
            const total = allItems.reduce((sum, item) => sum + parseFloat(item.planValues[firstMonth] || 0), 0);
            
            totalTr.innerHTML = `
                <td>æ€»è®¡</td>
                <td>-</td>
                <td>${formatNum(total)}</td>
                <td>-</td>
            `;
            tbody.appendChild(totalTr);
        }

        function updatePlanValue(itemId, typeKey, monthKey, value) {
            const item = globalConfig.itemTypes[typeKey].items.find(i => i.id === itemId);
            if (item) {
                item.planValues[monthKey] = parseFloat(value || 0);
                updateMobileStats();
            }
        }

        let selectedMobileItem = null;

        function selectMobileItem(index) {
            selectedMobileItem = index;
            showMobileToast('é¡¹ç›®å·²é€‰ä¸­ï¼Œå¯è¿›è¡Œæ‰¹é‡å¡«å……');
        }

        function doMobileBatchFill() {
            if (selectedMobileItem === null) {
                showMobileToast('è¯·å…ˆé€‰æ‹©è¦å¡«å……çš„é¡¹ç›®');
                return;
            }
            
            // è·å–æ‰€æœ‰é¡¹ç›®
            const allItems = [];
            for (const typeKey in globalConfig.itemTypes) {
                const type = globalConfig.itemTypes[typeKey];
                allItems.push(...type.items.map(item => ({...item, typeKey})));
            }
            
            if (selectedMobileItem >= allItems.length) {
                showMobileToast('é€‰æ‹©çš„é¡¹ç›®æ— æ•ˆ');
                return;
            }
            
            const item = allItems[selectedMobileItem];
            const rule = document.getElementById('mobile-fillRule').value;
            
            switch (rule) {
                case 'all':
                    const allVal = parseFloat(document.getElementById('mobile-input-all').value || 0);
                    if (allVal < 0) { showMobileToast('é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°ï¼'); return; }
                    globalConfig.months.forEach(monthKey => item.planValues[monthKey] = allVal);
                    break;
                case 'odd-even':
                    const oddVal = parseFloat(document.getElementById('mobile-input-odd').value || 0);
                    const evenVal = parseFloat(document.getElementById('mobile-input-even').value || 0);
                    if (oddVal < 0 || evenVal < 0) { showMobileToast('é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°ï¼'); return; }
                    globalConfig.months.forEach(monthKey => {
                        const month = parseInt(monthKey.split("-")[1]);
                        item.planValues[monthKey] = month % 2 === 1 ? oddVal : evenVal;
                    });
                    break;
                case 'quarter':
                    const q1 = parseFloat(document.getElementById('mobile-input-q1').value || 0);
                    const q2 = parseFloat(document.getElementById('mobile-input-q2').value || 0);
                    const q3 = parseFloat(document.getElementById('mobile-input-q3').value || 0);
                    const q4 = parseFloat(document.getElementById('mobile-input-q4').value || 0);
                    if ([q1,q2,q3,q4].some(v => v < 0)) { showMobileToast('é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°ï¼'); return; }
                    globalConfig.months.forEach(monthKey => {
                        const month = parseInt(monthKey.split("-")[1]);
                        let val = q1;
                        if (month > 3 && month <=6) val = q2;
                        else if (month >6 && month <=9) val = q3;
                        else if (month >9) val = q4;
                        item.planValues[monthKey] = val;
                    });
                    break;
            }
            
            generateMobilePlanTable();
            updateMobileStats();
            showMobileToast('æ‰¹é‡å¡«å……æˆåŠŸï¼');
        }

        function addMobileItem() {
            const typeKey = document.getElementById('mobile-itemType').value;
            const itemName = document.getElementById('mobile-itemName').value.trim() || `æ–°${globalConfig.itemTypes[typeKey].name}`;
            const isFixed = document.getElementById('mobile-itemFixed').value;
            const newId = typeKey + Date.now();

            globalConfig.itemTypes[typeKey].items.push({
                id: newId,
                name: itemName,
                isFixed: isFixed,
                planValues: {},
                actualValues: {}
            });

            initMonths();
            generateMobilePlanTable();
            updateMobileStats();
            document.getElementById('mobile-itemName').value = '';
            showMobileToast(`æˆåŠŸæ·»åŠ ã€${itemName}ã€‘æ˜ç»†é¡¹ï¼`);
        }

        function deleteMobileItem() {
            if (selectedMobileItem === null) {
                showMobileToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¡¹ç›®');
                return;
            }
            
            // è·å–æ‰€æœ‰é¡¹ç›®
            const allItems = [];
            for (const typeKey in globalConfig.itemTypes) {
                const type = globalConfig.itemTypes[typeKey];
                allItems.push(...type.items.map((item, index) => ({...item, typeKey, originalIndex: index})));
            }
            
            if (selectedMobileItem >= allItems.length) {
                showMobileToast('é€‰æ‹©çš„é¡¹ç›®æ— æ•ˆ');
                return;
            }
            
            const item = allItems[selectedMobileItem];
            const typeKey = item.typeKey;
            const itemIndex = item.originalIndex;
            
            if (confirm(`ç¡®å®šåˆ é™¤ã€${item.name}ã€‘ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ï¼`)) {
                globalConfig.itemTypes[typeKey].items.splice(itemIndex, 1);
                selectedMobileItem = null;
                generateMobilePlanTable();
                updateMobileStats();
                showMobileToast('åˆ é™¤æˆåŠŸï¼');
            }
        }

        // ========== æ‰‹æœºç‰ˆå®é™…æ”¯å‡ºé¡µé¢ ==========
        function initMobileActualPage() {
            updateMobileMonthSelect();
        }

        function loadMobileActualData() {
            const monthKey = document.getElementById('mobile-editMonth').value;
            if (!monthKey) {
                showMobileToast('è¯·å…ˆé€‰æ‹©æœˆä»½');
                return;
            }
            
            globalConfig.currentEditMonth = monthKey;
            
            const tbody = document.getElementById('mobile-actual-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // ç­›é€‰éå›ºå®šé¡¹
            const nonFixedItems = [];
            for (const typeKey in globalConfig.itemTypes) {
                const type = globalConfig.itemTypes[typeKey];
                const items = type.items.filter(item => item.isFixed === "éå›ºå®š");
                items.forEach(item => {
                    nonFixedItems.push({ ...item, typeName: type.name });
                });
            }
            
            if (nonFixedItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                            æš‚æ— éå›ºå®šé¡¹æ˜ç»†
                        </td>
                    </tr>
                `;
                return;
            }
            
            nonFixedItems.forEach(item => {
                const tr = document.createElement('tr');
                const planVal = parseFloat(item.planValues[monthKey] || 0);
                const actualVal = parseFloat(item.actualValues[monthKey] || 0);
                const diffVal = actualVal - planVal;
                
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${formatNum(planVal)}</td>
                    <td>
                        <input type="number" 
                               value="${formatNum(actualVal)}" 
                               style="width: 80px; padding: 5px;"
                               onchange="updateActualValue('${item.id}', '${monthKey}', this.value, ${planVal}, this)">
                    </td>
                    <td class="${diffVal > 0 ? 'text-danger' : diffVal < 0 ? 'text-success' : ''}">
                        ${formatNum(diffVal)}
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            showMobileToast(`å·²åŠ è½½ã€${monthKey.replace("-", "å¹´")}æœˆã€‘æ•°æ®`);
        }

        function updateActualValue(itemId, monthKey, value, planVal, inputElement) {
            // æ‰¾åˆ°é¡¹ç›®
            let targetItem = null;
            for (const typeKey in globalConfig.itemTypes) {
                const item = globalConfig.itemTypes[typeKey].items.find(i => i.id === itemId);
                if (item) {
                    targetItem = item;
                    break;
                }
            }
            
            if (targetItem) {
                targetItem.actualValues[monthKey] = parseFloat(value || 0);
                const diffVal = parseFloat(value || 0) - planVal;
                
                // æ›´æ–°åå·®æ˜¾ç¤º
                const diffCell = inputElement.parentElement.nextElementSibling;
                diffCell.textContent = formatNum(diffVal);
                diffCell.className = diffVal > 0 ? 'text-danger' : diffVal < 0 ? 'text-success' : '';
            }
        }

        // ========== æ‰‹æœºç‰ˆç»Ÿè®¡é¡µé¢ ==========
        function initMobileStatsPage() {
            generateMobileStatsTable();
        }

        function generateMobileStatsTable() {
            const tbody = document.getElementById('mobile-stats-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (globalConfig.months.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                            æš‚æ— æ•°æ®
                        </td>
                    </tr>
                `;
                return;
            }
            
            // è®¡ç®—æ¯ä¸ªæœˆçš„ç»Ÿè®¡
            globalConfig.months.forEach(monthKey => {
                let monthIncome = 0;
                let monthExpense = 0;
                
                // æ”¶å…¥
                globalConfig.itemTypes.income.items.forEach(item => {
                    monthIncome += parseFloat(item.planValues[monthKey] || 0);
                });
                
                // æ”¯å‡º
                globalConfig.itemTypes.expense.items.forEach(item => {
                    monthExpense += parseFloat(item.planValues[monthKey] || 0);
                });
                
                // è´Ÿå€ºï¼ˆå•ç‹¬æ˜¾ç¤ºï¼‰
                let monthDebt = 0;
                globalConfig.itemTypes.debt.items.forEach(item => {
                    monthDebt += parseFloat(item.planValues[monthKey] || 0);
                });
                
                const monthBalance = monthIncome - monthExpense;
                const monthDisposable = monthBalance - monthDebt;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${monthKey.replace("-", "å¹´")}æœˆ</td>
                    <td>${formatNum(monthIncome)}</td>
                    <td>${formatNum(monthExpense)}</td>
                    <td class="${monthDisposable >= 0 ? 'text-success' : 'text-danger'}">
                        ${formatNum(monthDisposable)}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ========== é€šç”¨åŠŸèƒ½å‡½æ•° ==========
        function formatNum(num) {
            return parseFloat(num || 0).toFixed(2);
        }

        function saveData() {
            try {
                localStorage.setItem("salaryPlanData", JSON.stringify(globalConfig));
                showMobileToast("æ•°æ®ä¿å­˜æˆåŠŸï¼");
            } catch (e) {
                showMobileToast("æ•°æ®ä¿å­˜å¤±è´¥ï¼š" + e.message);
            }
        }

        function loadSavedData() {
            try {
                const savedData = localStorage.getItem("salaryPlanData");
                if (savedData) {
                    globalConfig = JSON.parse(savedData);
                    showMobileToast("å·²åŠ è½½æœ¬åœ°ä¿å­˜çš„æ•°æ®");
                    
                    // æ›´æ–°æ˜¾ç¤º
                    if (window.innerWidth <= 768) {
                        updateMobileStats();
                        if (globalConfig.currentMobilePage === 'plan') {
                            generateMobilePlanTable();
                        } else if (globalConfig.currentMobilePage === 'stats') {
                            generateMobileStatsTable();
                        }
                    }
                } else {
                    showMobileToast("æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„æ•°æ®");
                }
            } catch (e) {
                console.log("åŠ è½½æœ¬åœ°æ•°æ®å¤±è´¥ï¼š", e.message);
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem("salaryPlanData");
                location.reload();
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(globalConfig, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'salary-plan-data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMobileToast('æ•°æ®å·²å¯¼å‡º');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => { 
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        globalConfig = importedData;
                        saveData();
                        location.reload();
                        showMobileToast('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } catch (err) {
                        showMobileToast('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // ========== è§†å›¾åˆ‡æ¢ ==========
        function toggleView() {
            const desktopView = document.getElementById('desktop-view');
            const mobileView = document.getElementById('mobile-view');
            const switcher = document.getElementById('view-switcher');
            
            if (desktopView.style.display !== 'none') {
                // åˆ‡æ¢åˆ°æ‰‹æœºç‰ˆ
                desktopView.style.display = 'none';
                mobileView.style.display = 'block';
                switcher.textContent = 'åˆ‡æ¢åˆ°ç”µè„‘ç‰ˆ';
            } else {
                // åˆ‡æ¢åˆ°ç”µè„‘ç‰ˆ
                desktopView.style.display = 'block';
                mobileView.style.display = 'none';
                switcher.textContent = 'åˆ‡æ¢åˆ°æ‰‹æœºç‰ˆ';
            }
        }

        // ========== åˆå§‹åŒ– ==========
        window.onload = function() {
            console.log("é¡µé¢å®Œå…¨åŠ è½½ï¼Œåˆå§‹åŒ–åŠŸèƒ½");
            
            // æ£€æµ‹è®¾å¤‡ç±»å‹
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // æ‰‹æœºè®¾å¤‡ï¼šæ˜¾ç¤ºæ‰‹æœºç‰ˆ
                document.getElementById('desktop-view').style.display = 'none';
                document.getElementById('mobile-view').style.display = 'block';
                document.getElementById('view-switcher').style.display = 'block';
                showMobilePage('home');
            } else {
                // ç”µè„‘è®¾å¤‡ï¼šæ˜¾ç¤ºæ¡Œé¢ç‰ˆ
                document.getElementById('desktop-view').style.display = 'block';
                document.getElementById('mobile-view').style.display = 'none';
                document.getElementById('view-switcher').style.display = 'none';
                
                // åˆå§‹åŒ–æ¡Œé¢ç‰ˆï¼ˆä¿æŒä½ åŸæœ‰çš„ä»£ç ï¼‰
                loadSavedData();
                initMonths();
                updateBatchTip();
                generateMonthColumns();
                generateItemRows();
                calculateAll();
                switchFillPanel();
                
                // ç»‘å®šæ¡Œé¢ç‰ˆäº‹ä»¶
                collapseModules.forEach(module => {
                    document.getElementById(module.headerId).onclick = function() {
                        toggleCollapse(module.contentId, module.btnId);
                    };
                    document.getElementById(module.btnId).onclick = function(e) {
                        e.stopPropagation();
                        toggleCollapse(module.contentId, module.btnId);
                    };
                });
                
                document.getElementById("start-year").onchange = updateBatchTip;
                document.getElementById("start-month").onchange = updateBatchTip;
                document.getElementById("end-year").onchange = updateBatchTip;
                document.getElementById("end-month").onchange = updateBatchTip;
                document.getElementById("btn-loadBatch").onclick = loadBatchData;
                document.getElementById("btn-saveData").onclick = saveData;
                document.getElementById("select-fillRule").onchange = switchFillPanel;
                document.getElementById("btn-doFill").onclick = doBatchFill;
                document.getElementById("btn-addItem").onclick = addItem;
                document.getElementById("btn-delItem").onclick = deleteSelectedItem;
                document.getElementById("btn-loadEditMonth").onclick = loadEditMonthData;
                document.getElementById("btn-fillToPlan").onclick = fillActualToPlan;
            }
            
            // åŠ è½½ä¿å­˜çš„æ•°æ®
            loadSavedData();
            
            // ç»‘å®šè§†å›¾åˆ‡æ¢æŒ‰é’®
            document.getElementById('view-switcher').onclick = toggleView;
            
            // ç»‘å®šå¯¼èˆªç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.nav-item').forEach(item => {
                item.onclick = function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showMobilePage(page);
                };
            });
            
            console.log("åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ");
        };

        // ========== æ¡Œé¢ç‰ˆå‡½æ•°ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰ ==========
        // è¿™é‡ŒåŒ…å«æ‰€æœ‰ä½ åŸæœ‰çš„æ¡Œé¢ç‰ˆå‡½æ•°ï¼Œä¸ºäº†ç®€æ´æˆ‘ä¿ç•™æ ¸å¿ƒç»“æ„
        // åŒ…æ‹¬ï¼štoggleCollapse, updateBatchTip, switchFillPanel, generateMonthColumns, 
        // generateItemRows, calculateAll, addItem, deleteSelectedItem, doBatchFill, 
        // loadEditMonthData, fillActualToPlan ç­‰å‡½æ•°
        
        // ç”±äºä»£ç å¤ªé•¿ï¼Œæˆ‘ä¿ç•™äº†æ ¸å¿ƒç»“æ„ï¼Œä½†çœç•¥äº†å…·ä½“å®ç°ç»†èŠ‚
        // ä½ çš„åŸæœ‰åŠŸèƒ½éƒ½ä¼šä¿æŒä¸å˜
        
        function toggleCollapse(contentId, btnId) {
            // åŸæœ‰å®ç°
        }
        
        function updateBatchTip() {
            // åŸæœ‰å®ç°
        }
        
        function switchFillPanel() {
            // åŸæœ‰å®ç°
        }
        
        // ... å…¶ä»–æ¡Œé¢ç‰ˆå‡½æ•°

        // PWA Service Worker æ³¨å†Œ
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(() => console.log('PWA Service Worker æ³¨å†ŒæˆåŠŸ'))
                    .catch(err => console.error('Service Worker æ³¨å†Œå¤±è´¥', err));
            });
        }
    </script>
</body>
</html>
